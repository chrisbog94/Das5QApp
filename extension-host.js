var _0x8939=['extensionStatus','isRunning','child','exitCode','signal','processStatus','/applets/:appletId','appletId','Getting\x20all\x20applets\x20with\x20id:\x20','findByAppletId','post','/pause/:id','pause','No\x20child\x20process\x20for\x20extension\x20with\x20id:\x20','message','NOT_FOUND','/disable/:id','disable','/start/:id','start','Sending\x20OK\x20response\x20for\x20child:\x20','/reset','factoryReset','Error\x20starting\x20extension\x20id:\x20','delete','remove','INTERNAL_SERVER_ERROR','/flash/:id','getChild','Could\x20not\x20find\x20child\x20process\x20for\x20extension:\x20','Asking\x20child\x20to\x20flash...','process','stringify','/install','body','Install\x20request:','releaseUrl','repoUrl','enable','Installing\x20appletId:\x20','Installing\x20from:\x20','Installing\x20with\x20user\x20config:\x20','Error\x20while\x20installing\x20applet\x20','error','/reconfigure/:id','Reconfigure\x20request\x20for:\x20','Reconfiguring\x20with\x20user\x20config:\x20','registerMessageResponse','CONFIGURATION_RESULT','Handling\x20configuration\x20result\x20message.','/upgrade','Upgrading\x20applet:\x20','upgrade','Error\x20while\x20upgrading:\x20','extension','getOauth2Client','client','code','getUri','redirect','Extension\x20does\x20not\x20have\x20a\x20proper\x20OAuth2\x20definition.','/oauth2/callback','Processing\x20callback\x20for\x20extension:\x20','Callback\x20URL\x20was:\x20','originalUrl','data','Got\x20data:\x20','storeTokens','Error\x20handling\x20callback.','Could\x20not\x20find\x20the\x20OAuth2\x20client\x20requesting\x20callback.','Could\x20not\x20find\x20the\x20extension\x20requesting\x20callback.','/options/:extensionId/:fieldName','/selections/:extensionId/:fieldName','success','listen','Express\x20server\x20started\x20on\x20port\x2027302','exports','cors','express','http','./lib/applet-logger','then','info','use','createServer','init','getExtensions','length','\x20extensions.','Starting\x20installed\x20extensions...','enabled','status','ExtensionState','INITIAL','-\x20Starting\x20extension:','-\x20Started\x20extension:','name','restart','initialize','-\x20Initializing\x20(but\x20not\x20starting)\x20disabled\x20extension:\x20','Extensions\x20have\x20all\x20started.','extensionId','params','query','getExtension','BAD_REQUEST','send','catch','No\x20extension\x20with\x20ID:\x20','get','No\x20extension\x20with\x20id:\x20','registered'];(function(_0x31ca37,_0x2b814f){var _0x4300cd=function(_0x5a8d09){while(--_0x5a8d09){_0x31ca37['push'](_0x31ca37['shift']());}};_0x4300cd(++_0x2b814f);}(_0x8939,0x12d));var _0x9893=function(_0x159c2c,_0x55c1fc){_0x159c2c=_0x159c2c-0x0;var _0x25e31b=_0x8939[_0x159c2c];return _0x25e31b;};const bodyParser=require('body-parser'),cors=require(_0x9893('0x0')),express=require(_0x9893('0x1')),http=require(_0x9893('0x2')),HttpStatus=require('http-status-codes'),logger=require(_0x9893('0x3')),em=require('./lib/extension-manager'),defaultListenPort=0x6aa6;async function run(){initExtensions()[_0x9893('0x4')](function(){initRoutes();});}logger[_0x9893('0x5')]('Extension\x20host\x20is\x20starting...'),run();const app=express();app[_0x9893('0x6')](cors()),app[_0x9893('0x6')](bodyParser['json']());const server=http[_0x9893('0x7')](app);async function initExtensions(){await em[_0x9893('0x8')]();let _0x35e471=await em[_0x9893('0x9')]();logger[_0x9893('0x5')]('I\x20have\x20'+_0x35e471[_0x9893('0xa')]+_0x9893('0xb')),logger[_0x9893('0x5')](_0x9893('0xc'));for(let _0x342321 of _0x35e471)if(_0x342321[_0x9893('0xd')]){_0x342321[_0x9893('0xe')]=em[_0x9893('0xf')][_0x9893('0x10')],logger[_0x9893('0x5')](_0x9893('0x11'),_0x342321['name']),em['start'](_0x342321),logger['info'](_0x9893('0x12'),_0x342321[_0x9893('0x13')]);const _0x1946e8=setTimeout(()=>{em[_0x9893('0x14')](_0x342321),clearTimeout(_0x1946e8);},0x2710);}else em[_0x9893('0x15')](_0x342321),logger[_0x9893('0x5')](_0x9893('0x16')+_0x342321[_0x9893('0x13')]);logger['info'](_0x9893('0x17'));}async function getOptions(_0x2fe502,_0x31948c){const _0x33426f=_0x2fe502['params'][_0x9893('0x18')],_0x32a9ef=_0x2fe502[_0x9893('0x19')]['fieldName'],_0x39b781=_0x2fe502[_0x9893('0x1a')]['search'];em[_0x9893('0x1b')](_0x33426f)['then'](_0x30ec06=>{try{em['getOptions'](_0x30ec06,_0x32a9ef,_0x39b781,_0x31948c);}catch(_0x216f52){_0x31948c[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')]('No\x20process\x20for\x20extension:\x20'+_0x33426f);}})[_0x9893('0x1e')](_0x34fda1=>{_0x31948c[_0x9893('0xe')](HttpStatus['BAD_REQUEST'])[_0x9893('0x1d')](_0x9893('0x1f')+_0x33426f);});}async function initRoutes(){logger[_0x9893('0x5')]('Initializing\x20routes...'),app[_0x9893('0x20')]('/',function(_0x345b51,_0x2ab7ed){em[_0x9893('0x9')]()[_0x9893('0x4')](function(_0x1d927d){_0x2ab7ed[_0x9893('0x1d')](_0x1d927d);});}),app[_0x9893('0x20')]('/:id',function(_0xfa6293,_0x40d336){let _0x161e48=_0xfa6293[_0x9893('0x19')]['id'];em[_0x9893('0x1b')](_0x161e48)[_0x9893('0x4')](function(_0x36bcb8){null===_0x36bcb8?_0x40d336[_0x9893('0xe')](0x194)[_0x9893('0x1d')](_0x9893('0x21')+_0x161e48):_0x40d336['send'](_0x36bcb8);});}),app[_0x9893('0x20')]('/status/:id',function(_0x49db44,_0x47e6f2){let _0xe0e22=_0x49db44[_0x9893('0x19')]['id'];em[_0x9893('0x1b')](_0xe0e22)[_0x9893('0x4')](function(_0x352769){let _0x3c9dc7={'id':_0xe0e22};null===_0x352769?_0x47e6f2[_0x9893('0xe')](0x194)[_0x9893('0x1d')]('No\x20extension\x20with\x20id:\x20'+_0xe0e22):(_0x3c9dc7[_0x9893('0x22')]=!0x0,_0x3c9dc7[_0x9893('0x23')]=_0x352769[_0x9893('0xe')],!_0x352769[_0x9893('0x24')]()&&_0x352769[_0x9893('0x25')]&&(_0x3c9dc7[_0x9893('0x26')]=_0x352769['child'][_0x9893('0x26')],_0x3c9dc7['signal']=_0x352769['child'][_0x9893('0x27')],_0x3c9dc7[_0x9893('0x28')]=_0x352769[_0x9893('0x25')][_0x9893('0xe')]),_0x47e6f2[_0x9893('0x1d')](_0x3c9dc7));});}),app['get'](_0x9893('0x29'),function(_0x1fb4cb,_0x2469b4){let _0x1510bf=_0x1fb4cb[_0x9893('0x19')][_0x9893('0x2a')];logger[_0x9893('0x5')](_0x9893('0x2b')+_0x1510bf);let _0x6aee5c=em[_0x9893('0x2c')](_0x1510bf);_0x2469b4['send'](_0x6aee5c);}),app[_0x9893('0x2d')](_0x9893('0x2e'),function(_0x2ef873,_0x577c5a){let _0x30776c=_0x2ef873['params']['id'];return em[_0x9893('0x1b')](_0x30776c)[_0x9893('0x4')](async function(_0x20a20c){try{null===(await em[_0x9893('0x2f')](_0x20a20c))?_0x577c5a[_0x9893('0xe')](HttpStatus['NOT_FOUND'])['send'](_0x9893('0x30')+_0x30776c):_0x577c5a[_0x9893('0x1d')](_0x20a20c);}catch(_0x1788cf){_0x577c5a[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x1788cf[_0x9893('0x31')]);}})[_0x9893('0x1e')](_0x532e92=>{_0x577c5a[_0x9893('0xe')](HttpStatus['BAD_REQUEST'])[_0x9893('0x1d')](_0x532e92[_0x9893('0x31')]);});}),app[_0x9893('0x2d')]('/stop/:id',function(_0x1fef09,_0x1e5bcd){let _0x357b48=_0x1fef09[_0x9893('0x19')]['id'];return em[_0x9893('0x1b')](_0x357b48)[_0x9893('0x4')](async function(_0x46f7dc){try{null===(await em['disable'](_0x46f7dc))?_0x1e5bcd[_0x9893('0xe')](HttpStatus[_0x9893('0x32')])[_0x9893('0x1d')](_0x9893('0x30')+_0x357b48):_0x1e5bcd[_0x9893('0x1d')](_0x46f7dc);}catch(_0x1227ca){_0x1e5bcd['status'](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x1227ca['message']);}})[_0x9893('0x1e')](_0x3a06fa=>{_0x1e5bcd['status'](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x3a06fa['message']);});}),app[_0x9893('0x2d')](_0x9893('0x33'),function(_0x18bfce,_0x1b64c2){let _0x11dfe2=_0x18bfce['params']['id'];return em[_0x9893('0x1b')](_0x11dfe2)[_0x9893('0x4')](async function(_0x56a3c9){try{await em[_0x9893('0x34')](_0x56a3c9);_0x1b64c2['send'](_0x56a3c9);}catch(_0x55e07c){_0x1b64c2[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x55e07c['message']);}});}),app[_0x9893('0x2d')](_0x9893('0x35'),function(_0x354abf,_0x3195af){let _0x1fdc27=_0x354abf[_0x9893('0x19')]['id'];return em[_0x9893('0x1b')](_0x1fdc27)['then'](function(_0x1e36c6){null===_0x1e36c6?_0x3195af[_0x9893('0xe')](HttpStatus['NOT_FOUND'])[_0x9893('0x1d')](_0x9893('0x21')+_0x1fdc27):em[_0x9893('0x36')](_0x1e36c6)['then'](_0xd32f3a=>{logger['info'](_0x9893('0x37')+_0xd32f3a['extension']['id']),_0x3195af[_0x9893('0x1d')](_0x1e36c6);},_0x36b5d5=>{_0x3195af[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')]('Error\x20starting\x20extension\x20id:\x20'+_0x1fdc27+';\x20'+_0x36b5d5);})['catch'](_0x30ca87=>{_0x3195af[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x30ca87[_0x9893('0x31')]);});});}),app[_0x9893('0x2d')](_0x9893('0x38'),async function(_0x46f802,_0x4d89b9){em[_0x9893('0x39')]()[_0x9893('0x4')](()=>{_0x4d89b9[_0x9893('0xe')](HttpStatus['OK'])['send']();})[_0x9893('0x1e')](_0x4c3654=>{_0x4d89b9[_0x9893('0xe')](HttpStatus['INTERNAL_SERVER_ERROR'])[_0x9893('0x1d')](_0x4c3654);});}),app[_0x9893('0x2d')]('/restart/:id',async function(_0x1547a4,_0x40a3a9){let _0x4f973f=_0x1547a4['params']['id'];return em[_0x9893('0x1b')](_0x4f973f)[_0x9893('0x4')](function(_0x21da9b){null===_0x21da9b?_0x40a3a9[_0x9893('0xe')](HttpStatus[_0x9893('0x32')])[_0x9893('0x1d')](_0x9893('0x21')+_0x4f973f):em[_0x9893('0x14')](_0x21da9b)[_0x9893('0x4')](function(_0x356b87){_0x356b87?_0x40a3a9[_0x9893('0x1d')](_0x21da9b):_0x40a3a9[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x9893('0x3a')+_0x4f973f+';\x20'+error);});});}),app[_0x9893('0x3b')]('/:id',async function(_0x15f099,_0x428ab8){let _0x59dcf0=_0x15f099[_0x9893('0x19')]['id'];return em[_0x9893('0x1b')](_0x59dcf0)[_0x9893('0x4')](function(_0x92ed93){null===_0x92ed93?_0x428ab8[_0x9893('0xe')](HttpStatus[_0x9893('0x32')])[_0x9893('0x1d')](_0x9893('0x21')+_0x59dcf0):em[_0x9893('0x3c')](_0x92ed93)[_0x9893('0x4')](function(_0x49e35e){_0x49e35e?_0x428ab8['status'](HttpStatus['OK'])[_0x9893('0x1d')]():_0x428ab8[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')]();});})['catch'](_0x3145f0=>{_0x428ab8[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])['send']();});}),app[_0x9893('0x2d')](_0x9893('0x3e'),async function(_0x135aa0,_0x413cfc){let _0x519fc5=_0x135aa0['params']['id'];const _0x1d48cd=em[_0x9893('0x3f')](_0x519fc5);null==_0x1d48cd?_0x413cfc[_0x9893('0xe')](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x9893('0x40')+_0x519fc5):(logger[_0x9893('0x5')](_0x9893('0x41')),_0x1d48cd[_0x9893('0x42')][_0x9893('0x1d')](JSON[_0x9893('0x43')]({'data':{'type':'FLASH'}})),_0x413cfc[_0x9893('0xe')](HttpStatus['OK'])[_0x9893('0x1d')]());}),app[_0x9893('0x2d')](_0x9893('0x44'),async function(_0x36142f,_0xc8674b){let _0x457a4e=_0x36142f[_0x9893('0x45')];logger[_0x9893('0x5')](_0x9893('0x46'),_0x457a4e);let _0x2abf42=_0x457a4e[_0x9893('0x2a')],_0x2a4327=_0x457a4e[_0x9893('0x47')]||_0x457a4e[_0x9893('0x48')]||'',_0x3d0299=_0x457a4e['config']||{},_0x52f66e=_0x457a4e[_0x9893('0x49')];return null===_0x52f66e&&(_0x52f66e=!0x0),logger[_0x9893('0x5')](_0x9893('0x4a')+_0x2abf42),logger[_0x9893('0x5')](_0x9893('0x4b')+_0x2a4327),logger[_0x9893('0x5')](_0x9893('0x4c'),_0x3d0299),em['install'](_0x2abf42,_0x2a4327,_0x3d0299,_0x52f66e)[_0x9893('0x4')](_0x4e2f58=>{_0xc8674b[_0x9893('0x1d')](jSendSuccess(_0x4e2f58));})[_0x9893('0x1e')](_0x18d67e=>{const _0x38a746=_0x9893('0x4d')+_0x2abf42;logger[_0x9893('0x4e')](_0x38a746),_0xc8674b[_0x9893('0xe')](HttpStatus['INTERNAL_SERVER_ERROR'])[_0x9893('0x1d')](jSendError(_0x38a746,{'details':_0x18d67e}));});}),app[_0x9893('0x2d')](_0x9893('0x4f'),async function(_0x423aaf,_0x339409){let _0x4c812c=_0x423aaf[_0x9893('0x19')]['id'],_0x3e46e1=_0x423aaf[_0x9893('0x45')];logger[_0x9893('0x5')](_0x9893('0x50')+_0x4c812c,_0x3e46e1);let _0x4d2d73=_0x3e46e1||{};return logger['info'](_0x9893('0x51'),_0x4d2d73),em[_0x9893('0x1b')](_0x4c812c)[_0x9893('0x4')](function(_0x17c561){em['reconfigure'](_0x17c561,_0x4d2d73)[_0x9893('0x4')](_0xf773d8=>{_0xf773d8?em[_0x9893('0x52')](_0x4c812c,_0x3dbf27=>{logger[_0x9893('0x5')]('Got\x20callback\x20for\x20message:\x20',_0x3dbf27);try{_0x9893('0x53')===(_0x3dbf27['data']||{})['type']&&(logger[_0x9893('0x5')](_0x9893('0x54')),_0x9893('0x4e')===_0x3dbf27['status']?_0x339409[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')](_0x3dbf27[_0x9893('0x31')]):_0x339409[_0x9893('0x1d')](_0x17c561));}catch(_0x4d1131){}}):_0x339409['send'](_0x17c561);})[_0x9893('0x1e')](_0x4cb994=>{_0x339409[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')](_0x4cb994+'');});})[_0x9893('0x1e')](_0x348849=>{_0x339409['status'](HttpStatus[_0x9893('0x1c')])[_0x9893('0x1d')](_0x348849[_0x9893('0x31')]);});}),app[_0x9893('0x2d')](_0x9893('0x55'),async function(_0x234292,_0x27764c){let _0x5d531d=_0x234292[_0x9893('0x45')];logger['info']('Upgrade\x20request:',_0x5d531d);let _0x118389=_0x5d531d['appletId'],_0x29f805=_0x5d531d['releaseUrl']||_0x5d531d['repoUrl']||'';return logger['info'](_0x9893('0x56')+_0x118389),em[_0x9893('0x57')](_0x118389,_0x29f805)[_0x9893('0x4')](_0x2d1ae0=>{_0x27764c[_0x9893('0x1d')](_0x2d1ae0);})[_0x9893('0x1e')](_0x543df6=>{logger[_0x9893('0x4e')](_0x9893('0x58'),_0x543df6),_0x27764c['status'](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')](_0x543df6+'');});});let _0x58aacf={};app[_0x9893('0x20')]('/oauth2/authorize/:extensionId',async function(_0xb5f9c,_0x33caac){let _0xef5ecf=_0xb5f9c[_0x9893('0x19')]['extensionId'];em[_0x9893('0x1b')](_0xef5ecf)['then'](_0x5e1c60=>{_0x58aacf[_0x9893('0x59')]=_0x5e1c60;try{const _0x14f60c=em[_0x9893('0x5a')](_0x5e1c60);_0x58aacf[_0x9893('0x5b')]=_0x14f60c;const _0xd86564=_0x14f60c[_0x9893('0x5c')][_0x9893('0x5d')]();logger[_0x9893('0x5')]('Redirecting\x20to\x20authUri:',_0xd86564),_0x33caac[_0x9893('0x5e')](_0xd86564);}catch(_0x514894){_0x33caac['status'](HttpStatus[_0x9893('0x3d')])['send'](_0x9893('0x5f')+_0x514894);}})[_0x9893('0x1e')](_0x5016c0=>{_0x33caac['status'](HttpStatus['BAD_REQUEST'])['send']('No\x20extension\x20with\x20ID:\x20'+_0xef5ecf);});}),app[_0x9893('0x20')](_0x9893('0x60'),async function(_0x1b33df,_0x5606be){const _0x24b9a2=_0x58aacf[_0x9893('0x59')],_0x5e824a=_0x58aacf['client'];if(_0x24b9a2){if(_0x5e824a)return logger[_0x9893('0x5')](_0x9893('0x61')+_0x24b9a2['id']),logger['info'](_0x9893('0x62')+_0x1b33df[_0x9893('0x63')]),_0x5e824a[_0x9893('0x5c')]['getToken'](_0x1b33df[_0x9893('0x63')])[_0x9893('0x4')](_0x4214cb=>{const _0x1b33df=_0x4214cb[_0x9893('0x64')];logger[_0x9893('0x5')](_0x9893('0x65'),_0x1b33df),em[_0x9893('0x66')](_0x24b9a2[_0x9893('0x2a')],_0x1b33df),_0x5606be['send'](_0x1b33df);})[_0x9893('0x1e')](_0x318a5d=>{logger[_0x9893('0x5')](_0x9893('0x67'),_0x318a5d),_0x5606be[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')](_0x318a5d[_0x9893('0x45')]);});logger[_0x9893('0x4e')](_0x9893('0x68')),_0x5606be[_0x9893('0xe')](HttpStatus[_0x9893('0x3d')])[_0x9893('0x1d')](_0x9893('0x68'));}else logger[_0x9893('0x4e')](_0x9893('0x69')),_0x5606be['status'](HttpStatus['INTERNAL_SERVER_ERROR'])[_0x9893('0x1d')]('Could\x20not\x20find\x20the\x20extension\x20requesting\x20callback.');}),app[_0x9893('0x2d')](_0x9893('0x6a'),getOptions),app[_0x9893('0x2d')](_0x9893('0x6b'),getOptions),logger[_0x9893('0x5')]('Routes\x20initialized.');}function jSendError(_0x1b4c44,_0xb750db,_0x4d1e5c){const _0x23ed5c=jSend(_0x9893('0x4e'),_0xb750db);return _0x1b4c44&&(_0x23ed5c[_0x9893('0x31')]=_0x1b4c44),_0x4d1e5c&&(_0x23ed5c[_0x9893('0x5c')]=_0x4d1e5c),_0x23ed5c;}function jSendFail(_0x4669ef){return jSend('fail',_0x4669ef||{});}function jSendSuccess(_0x50db4d){return jSend(_0x9893('0x6c'),_0x50db4d||{});}function jSend(_0x580020,_0x58b4a5){const _0x2bc2d5={'status':_0x580020};return _0x58b4a5&&(_0x2bc2d5[_0x9893('0x64')]=_0x58b4a5),_0x2bc2d5;}server[_0x9893('0x6d')](0x6aa6),logger[_0x9893('0x5')](_0x9893('0x6e')),module[_0x9893('0x6f')]={'server':server};