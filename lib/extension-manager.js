var _0xc0bf=['Singleton\x20extension\x20already\x20exists\x20at\x20','Beginning\x20installation\x20of\x20applet:\x20','Deleting\x20previously\x20installed\x20extension\x20at:\x20','Error\x20installing\x20package\x20at\x20','ERROR','Entering\x20post-install\x20phase...','package.json','push','catch','Error\x20while\x20starting\x20extension\x20','Error\x20while\x20initializing\x20extension\x20','Error\x20reading\x20extension\x20package\x20at\x20','file://','Installing\x20applet\x20at:\x20','endsWith','startsWith','Installing\x20from\x20file:\x20','substr','lastIndexOf','Will\x20download\x20to\x20','Downloading\x20zip\x20file....','then','Deleting\x20zip\x20file\x20at:\x20','Sideloading\x20from\x20path:\x20','\x20to\x20','limit','Error\x20while\x20sideloading\x20app.','Expected\x20a\x20.zip\x20URL','....','No\x20files\x20were\x20extracted.','Reconfiguring\x20extension\x20','STARTED','INITIALIZED','PAUSED','Current\x20status\x20is:\x20','Error\x20while\x20reconfiguring\x20extension\x20','Requesting\x20extension\x20to\x20reconfigure...','send','CONFIGURE','Could\x20not\x20find\x20a\x20process\x20to\x20send\x20reconfigure\x20request.','Stopping\x20installed\x20extensions...','\x20existing\x20instances.','Stopping\x20','Stopped.','Could\x20not\x20read\x20package\x20from\x20','INSTALLED','Restarting\x20extensions...','Restarting\x20','Update\x20complete.','Error\x20deleting\x20previously\x20installed\x20extension\x20from\x20file\x20system','\x20to\x20install.','STOPPING','Waiting\x20for\x20extension\x20','\x20to\x20stop.','Extension\x20is\x20in\x20error\x20state.','Extension\x20','\x20is\x20in\x20error\x20state.','REMOVING','Extension\x20is\x20being\x20removed,\x20ignoring.','INITIALIZING','Initializing\x20extension:\x20','I\x20have\x20','\x20children\x20currently\x20running','Extension\x20does\x20not\x20have\x20a\x20package\x20defined.','Extension\x20does\x20not\x20have\x20an\x20entry\x20point\x20defined.','Forking\x20process\x20at:\x20','\x20\x20with\x20config:\x20','stringify','assign','Fork\x20created','No\x20extension\x20installed\x20at\x20expected\x20location:\x20','geometry','Extension\x20config\x20does\x20not\x20have\x20a\x20geometry\x20defined.','extensionId','storageLocation','Maximum\x20number\x20of\x20start\x20attempts\x20exceeded\x20for\x20','Asking\x20extension\x20','STARTING','\x20is\x20already\x20starting\x20or\x20started.','Current\x20status\x20is\x20','START','Child\x20process\x20has\x20been\x20sent\x20the\x20START\x20signal','child','Pausing\x20child\x20process\x20for\x20extension:\x20','PAUSING','PAUSE','Error\x20while\x20trying\x20to\x20pause\x20extension:\x20','No\x20child\x20process\x20for\x20extensions:\x20','warn','Attempted\x20to\x20stop\x20an\x20extension\x20that\x20is\x20not\x20running:\x20','Stopping\x20child\x20process\x20for\x20extension:\x20','kill','SIGINT','Error\x20while\x20trying\x20to\x20stop\x20extension:\x20','UNKNOWN','Failed\x20to\x20stop\x20after\x20','Removing\x20child\x20instance\x20for\x20','indexOf','Removing\x20\x20child\x20from\x20list\x20at\x20index:\x20','splice','The\x20child\x20instance\x20is\x20not\x20in\x20the\x20instances\x20list.','Restarting\x20extension:\x20','UNINSTALLING','Delete\x20successful.','Deleting\x20existing\x20extension\x20at:\x20','Cannot\x20register\x20child\x20events\x20for\x20undefined\x20child.','disconnect','close','\x27PARENT\x20received\x20message\x20from\x20child:\x20','data','type','PARENT:\x20Don\x27t\x20know\x20what\x20to\x20do\x20with:\x20','\x20received\x20\x27','\x27\x20with\x20code\x20\x27','\x27\x20and\x20signal\x20\x27','exitCode','signal','get','Error\x20storing\x20extensions.','I\x20could\x20not\x20find\x20the\x20child\x20for\x20','Found\x20extension:\x20','No\x20match\x20found\x20for\x20id:\x20','requirements','clientSecret','accessTokenUri','authorizationUri','http://localhost:27302/oauth2/callback','scopes','OPTIONS','No\x20child\x20process\x20for\x20extension:\x20','options','PARENT:\x20Handled','Removing\x20extension:\x20','Finished\x20removing\x20extension:\x20','readdir','join','Error\x20unlinking\x20file:\x20','freeze','INSTALLING','exports','decompress','delete','download','load-json-file','ncp','path','./storage','uuid/v4','./validate-package-json-fields','child_process','fork','env','EM_STORAGE_ROOT','resolve','q_storage','extensions','info','existsSync','Error\x20making\x20required\x20directory\x20at:\x20','exit','put','initialized','error','Error\x20initializing\x20storage:\x20','main.json','Migrating\x20legacy\x20storage....','./migrate','migrateStorage','sync','releaseUrl','appletId','package','name','entryPoint','enabled','status','INITIAL','applyPackage','main','Applying\x20package:','qConfig','Could\x20not\x20find\x20a\x20qConfig\x20entry\x20in\x20this\x20package.\x20Is\x20it\x20a\x20Q\x20Desktop\x20Extension?','isSingleton','applyConfig','defaults','applet','authorization','Package\x20config:','Defaults:','User\x20config:','config','Fully\x20resolved\x20config:','isRunning','STOPPED','revive','repoUrl','extension','process','registered','Must\x20provide\x20appletId.','Must\x20provide\x20releaseUrl.','length'];(function(_0x19cd35,_0x50dfd8){var _0x5916a8=function(_0x2b546){while(--_0x2b546){_0x19cd35['push'](_0x19cd35['shift']());}};_0x5916a8(++_0x50dfd8);}(_0xc0bf,0x8c));var _0xfc0b=function(_0x2376d0,_0x54e870){_0x2376d0=_0x2376d0-0x0;var _0x1d3f1b=_0xc0bf[_0x2376d0];return _0x1d3f1b;};const ClientOAuth2=require('client-oauth2'),decompress=require(_0xfc0b('0x0')),del=require(_0xfc0b('0x1')),download=require(_0xfc0b('0x2')),fs=require('fs'),loadJsonFile=require(_0xfc0b('0x3'))['sync'],logger=require('./applet-logger'),ncp=require(_0xfc0b('0x4'))[_0xfc0b('0x4')],Path=require(_0xfc0b('0x5')),{Storage:Storage}=require(_0xfc0b('0x6')),uuidv4=require(_0xfc0b('0x7')),{validatePackageFile:validatePackageFile}=require(_0xfc0b('0x8')),fork=require(_0xfc0b('0x9'))[_0xfc0b('0xa')];process[_0xfc0b('0xb')][_0xfc0b('0xc')]&&logger['info']('Received\x20environment\x20variable\x20EM_STORAGE_ROOT:\x20'+process['env']['EM_STORAGE_ROOT']);const storageRoot=Path[_0xfc0b('0xd')](process[_0xfc0b('0xb')][_0xfc0b('0xc')]||'.');let store=null;const extensionBaseDir=Path['resolve'](storageRoot,'q_extensions'),localStorageRoot=Path[_0xfc0b('0xd')](storageRoot,_0xfc0b('0xe')),localStoragePath=Path['resolve'](localStorageRoot,'main'),extensionStorageDir=Path[_0xfc0b('0xd')](localStorageRoot,_0xfc0b('0xf'));let extensions=null;const instances=[];async function init(){try{for(path of(logger['info']('Initializing\x20paths...'),[storageRoot,localStorageRoot,localStoragePath,extensionBaseDir,extensionStorageDir]))if(logger[_0xfc0b('0x10')]('Initializing\x20path:\x20'+path),!fs[_0xfc0b('0x11')](path))try{fs['mkdirSync'](path,{'recursive':!0x0});}catch(_0x30d64a){logger['error'](_0xfc0b('0x12')+path),process[_0xfc0b('0x13')](0x1);}logger[_0xfc0b('0x10')]('Initializing\x20storage\x20at\x20'+localStoragePath),(store=new Storage(localStoragePath))[_0xfc0b('0x14')](_0xfc0b('0x15'),new Date()),logger['info']('Storage\x20initialized.'),migrateStorage();}catch(_0x234f45){logger[_0xfc0b('0x16')](_0xfc0b('0x17')+_0x234f45),process[_0xfc0b('0x13')](0x2);}}function migrateStorage(){const _0x3d1423=Path['resolve'](localStorageRoot,_0xfc0b('0x18'));if(fs[_0xfc0b('0x11')](_0x3d1423)){logger['info'](_0xfc0b('0x19'));try{require(_0xfc0b('0x1a'))[_0xfc0b('0x1b')](_0x3d1423,store),del[_0xfc0b('0x1c')](_0x3d1423);}catch(_0x53ec0c){logger[_0xfc0b('0x16')]('Error\x20while\x20migrating\x20from\x20legacy\x20storage\x20at\x20'+_0x3d1423+';\x20'+_0x53ec0c);}}}class Extension{constructor(_0x18cda9){this[_0xfc0b('0x1d')]=_0x18cda9,this['id']=uuidv4(),this[_0xfc0b('0x1e')]=null,this[_0xfc0b('0x1f')]=null,this[_0xfc0b('0x20')]=null,this[_0xfc0b('0x21')]=null,this[_0xfc0b('0x22')]=null,this['config']={},this[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x24')],this['isSingleton']=!0x1;}[_0xfc0b('0x25')](_0x2a5e89){this['package']=_0x2a5e89,this['name']=_0x2a5e89[_0xfc0b('0x20')],this[_0xfc0b('0x21')]=_0x2a5e89[_0xfc0b('0x26')],logger['info'](_0xfc0b('0x27'),_0x2a5e89);let _0x1b57d1=_0x2a5e89[_0xfc0b('0x28')];if(!_0x1b57d1)throw new Error(_0xfc0b('0x29'));this['isSingleton']=_0x1b57d1[_0xfc0b('0x2a')]||!0x1;}[_0xfc0b('0x2b')](_0x37fc69,_0x562330={}){let _0xe43fd6=_0x37fc69[_0xfc0b('0x28')];if(!_0xe43fd6)throw new Error('Could\x20not\x20find\x20a\x20qConfig\x20entry\x20in\x20this\x20package.\x20Is\x20it\x20a\x20Q\x20Desktop\x20Extension?');let _0x52c334=(_0xe43fd6['applet']||{})[_0xfc0b('0x2c')]||{},_0x39cfdc=_0x562330[_0xfc0b('0x2d')]||{},_0x391416=_0x562330['geometry']||{},_0x137695=_0x562330[_0xfc0b('0x2e')]||{};logger['info'](_0xfc0b('0x2f'),_0xe43fd6),logger[_0xfc0b('0x10')](_0xfc0b('0x30'),_0x52c334),logger['info'](_0xfc0b('0x31'),_0x562330[_0xfc0b('0x2d')]),this[_0xfc0b('0x32')]={'authorization':_0x137695,'applet':{'user':_0x39cfdc,'defaults':_0x52c334},'geometry':_0x391416},logger[_0xfc0b('0x10')](_0xfc0b('0x33'),this[_0xfc0b('0x32')]);}[_0xfc0b('0x34')](){return!(ExtensionState[_0xfc0b('0x35')]===this['status']);}}Extension[_0xfc0b('0x36')]=function(_0x18e2d5){let _0x480ca4=new Extension();return _0x480ca4[_0xfc0b('0x1d')]=_0x18e2d5[_0xfc0b('0x1d')]||_0x18e2d5[_0xfc0b('0x37')]||'',_0x480ca4['id']=_0x18e2d5['id'],_0x480ca4['appletId']=_0x18e2d5[_0xfc0b('0x1e')],_0x480ca4[_0xfc0b('0x1f')]=_0x18e2d5[_0xfc0b('0x1f')],_0x480ca4['name']=_0x18e2d5[_0xfc0b('0x20')],_0x480ca4[_0xfc0b('0x21')]=_0x18e2d5['entryPoint'],_0x480ca4[_0xfc0b('0x22')]=_0x18e2d5['enabled'],_0x480ca4[_0xfc0b('0x32')]=_0x18e2d5[_0xfc0b('0x32')],_0x480ca4[_0xfc0b('0x23')]=_0x18e2d5[_0xfc0b('0x23')],_0x480ca4[_0xfc0b('0x2a')]=_0x18e2d5[_0xfc0b('0x2a')],_0x480ca4;};class ExtensionInstance{constructor(_0x50fa86,_0x326d20){this[_0xfc0b('0x38')]=_0x50fa86,this[_0xfc0b('0x39')]=_0x326d20,this[_0xfc0b('0x3a')]=!0x0;}}async function install(_0x5e4a70,_0xd36cd5,_0x39a8ad={},_0x101246=!0x1){if(!_0x5e4a70&&0x0!=_0x5e4a70)throw new Error(_0xfc0b('0x3b'));if(!_0xd36cd5)throw new Error(_0xfc0b('0x3c'));let _0x269edc=findByAppletId(_0x5e4a70),_0x469000=_0x269edc&&_0x269edc[_0xfc0b('0x3d')]>0x0?_0x269edc[0x0]:null,_0x257c35=_0x469000&&!_0x469000[_0xfc0b('0x2a')];if(_0x469000&&!_0x257c35)throw new Error(_0xfc0b('0x3e')+_0xd36cd5,_0x469000);let _0x40a01d=new Extension(_0xd36cd5);if(_0x40a01d[_0xfc0b('0x1e')]=_0x5e4a70,_0x40a01d['enabled']=_0x101246,_0x257c35)return logger[_0xfc0b('0x10')]('Extension\x20applet\x20is\x20already\x20installed\x20for\x20'+_0xd36cd5),postInstall(_0x40a01d,_0x39a8ad,_0x101246);{logger[_0xfc0b('0x10')](_0xfc0b('0x3f')+_0x5e4a70+',\x20release:\x20'+_0xd36cd5),_0x40a01d[_0xfc0b('0x23')]=ExtensionState['INSTALLING'];let _0x59871c=Path[_0xfc0b('0xd')](extensionBaseDir,_0x5e4a70+'');if(fs[_0xfc0b('0x11')](_0x59871c)){logger[_0xfc0b('0x10')](_0xfc0b('0x40')+_0x59871c);try{del[_0xfc0b('0x1c')](_0x59871c);}catch(_0x3a2f4c){throw logger[_0xfc0b('0x16')]('Error\x20deleting\x20previously\x20installed\x20extension\x20from\x20file\x20system',_0x3a2f4c),_0x3a2f4c;}}return downloadAndInstall(_0xd36cd5,_0x59871c)['then'](()=>postInstall(_0x40a01d,_0x39a8ad,_0x101246))['catch'](_0x2c4da3=>{throw logger[_0xfc0b('0x16')](_0xfc0b('0x41')+_0x59871c+';\x20'+_0x2c4da3),_0x40a01d[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x42')],_0x2c4da3;});}}async function postInstall(_0x5f4540,_0x57a275,_0x5e35ab){logger['info'](_0xfc0b('0x43')),_0x5f4540['status']=ExtensionState['INSTALLED'];let _0x5a0e6f=Path['resolve'](extensionBaseDir,_0x5f4540['appletId']+''),_0x154372=Path[_0xfc0b('0xd')](_0x5a0e6f,_0xfc0b('0x44'));try{let _0x4ffac=loadJsonFile(_0x154372);return _0x5f4540[_0xfc0b('0x25')](_0x4ffac),_0x5f4540[_0xfc0b('0x2b')](_0x4ffac,_0x57a275),extensions[_0xfc0b('0x45')](_0x5f4540),updateExtensionStore(),_0x5e35ab?start(_0x5f4540)[_0xfc0b('0x46')](_0x1f1a3e=>{logger[_0xfc0b('0x16')](_0xfc0b('0x47')+_0x5f4540['id']+':\x20'+_0x1f1a3e);}):initialize(_0x5f4540)[_0xfc0b('0x46')](_0x4afb60=>{logger[_0xfc0b('0x16')](_0xfc0b('0x48')+_0x5f4540['id']+':\x20'+_0x4afb60);}),logger[_0xfc0b('0x10')]('Post-install\x20complete.'),_0x5f4540;}catch(_0x3b810c){throw logger[_0xfc0b('0x16')](_0xfc0b('0x49')+_0x154372,_0x3b810c),_0x5f4540[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x42')],_0x3b810c;}}const FILE_URL_BASE=_0xfc0b('0x4a');async function downloadAndInstall(_0x149c00,_0x1eca60){if(logger[_0xfc0b('0x10')](_0xfc0b('0x4b')+_0x149c00),_0x149c00[_0xfc0b('0x4c')]('.zip')){if(_0x149c00[_0xfc0b('0x4d')](FILE_URL_BASE)){const _0x56a6ab=_0x149c00['substring'](FILE_URL_BASE[_0xfc0b('0x3d')]);return logger[_0xfc0b('0x10')](_0xfc0b('0x4e')+_0x56a6ab),decompressZip(_0x56a6ab,_0x1eca60)['then'](()=>{const _0x149c00=validatePackageFile(Path[_0xfc0b('0xd')](_0x1eca60,_0xfc0b('0x44')));if(_0x149c00&&_0x149c00['length']>0x0)throw new Error(_0x149c00);});}{const _0x587839=_0x149c00[_0xfc0b('0x4f')](_0x149c00[_0xfc0b('0x50')]('/')+0x1);return logger[_0xfc0b('0x10')](_0xfc0b('0x51')+_0x587839),del[_0xfc0b('0x1c')](_0x587839),logger[_0xfc0b('0x10')](_0xfc0b('0x52')),download(_0x149c00,extensionBaseDir,{'filename':_0x587839})['then'](async()=>{const _0x149c00=Path[_0xfc0b('0xd')](extensionBaseDir,_0x587839);return decompressZip(_0x149c00,_0x1eca60)[_0xfc0b('0x53')](()=>{logger[_0xfc0b('0x10')](_0xfc0b('0x54')+_0x149c00),del[_0xfc0b('0x1c')](_0x149c00);});});}}if(_0x149c00[_0xfc0b('0x4d')](FILE_URL_BASE)){const _0x40dfaa=Path[_0xfc0b('0xd')](_0x149c00[_0xfc0b('0x4f')](FILE_URL_BASE[_0xfc0b('0x3d')]));return logger[_0xfc0b('0x10')](_0xfc0b('0x55')+_0x40dfaa+_0xfc0b('0x56')+_0x1eca60),ncp[_0xfc0b('0x57')]=0x10,new Promise((_0x51b026,_0x12a6e7)=>{ncp(_0x40dfaa,_0x1eca60,function(_0x220ed5){if(_0x220ed5)logger[_0xfc0b('0x16')](_0xfc0b('0x58')),_0x12a6e7(_0x220ed5);else{const _0x220ed5=validatePackageFile(Path['resolve'](_0x1eca60,_0xfc0b('0x44')));_0x220ed5&&_0x220ed5[_0xfc0b('0x3d')]>0x0?_0x12a6e7(_0x220ed5):_0x51b026();}});});}throw new Error(_0xfc0b('0x59'));}async function decompressZip(_0x6aa191,_0x537f65){return logger['info']('Decompressing\x20zip\x20file\x20at\x20'+_0x6aa191+_0xfc0b('0x5a')),decompress(_0x6aa191,_0x537f65,{'strip':0x1})['then'](_0x599ace=>{if(!_0x599ace||!_0x599ace[0x0])throw new Error(_0xfc0b('0x5b'));logger[_0xfc0b('0x10')]('Decompression\x20complete.');});}async function configure(_0xb98bf7,_0x5ab00c){logger[_0xfc0b('0x10')](_0xfc0b('0x5c')+_0xb98bf7['id']);let _0x1d56f7=ExtensionState[_0xfc0b('0x5d')]==_0xb98bf7['status'],_0x256366=ExtensionState[_0xfc0b('0x5e')]==_0xb98bf7[_0xfc0b('0x23')],_0xc35ccc=ExtensionState[_0xfc0b('0x5f')]==_0xb98bf7[_0xfc0b('0x23')];logger[_0xfc0b('0x10')](_0xfc0b('0x60')+_0xb98bf7['status']);let _0x38b5cf=Path['resolve'](extensionBaseDir,_0xb98bf7[_0xfc0b('0x1e')]+''),_0x443413=Path[_0xfc0b('0xd')](_0x38b5cf,'package.json');try{let _0x469e05=loadJsonFile(_0x443413);_0xb98bf7[_0xfc0b('0x2b')](_0x469e05,_0x5ab00c),updateExtensionStore();}catch(_0x155168){throw logger[_0xfc0b('0x16')](_0xfc0b('0x61')+_0xb98bf7['id'],_0x155168),new Error(_0x155168);}if(_0x256366||_0x1d56f7||_0xc35ccc){logger[_0xfc0b('0x10')](_0xfc0b('0x62'));let _0x5ab00c=getChild(_0xb98bf7['id']);if(_0x5ab00c&&_0x5ab00c[_0xfc0b('0x39')])return generateRuntimeConfiguration(_0xb98bf7)[_0xfc0b('0x53')](_0x33a3b8=>{_0x5ab00c[_0xfc0b('0x39')][_0xfc0b('0x63')](JSON['stringify']({'data':{'type':_0xfc0b('0x64'),'configuration':_0x33a3b8}}));}),!0x0;throw logger[_0xfc0b('0x16')](_0xfc0b('0x65')),new Error(_0xfc0b('0x65'));}return!0x1;}async function upgrade(_0x5e342c,_0x43fbf3){logger[_0xfc0b('0x10')](_0xfc0b('0x66'));let _0x347878=findByAppletId(_0x5e342c);logger[_0xfc0b('0x10')]('Found\x20'+_0x347878[_0xfc0b('0x3d')]+_0xfc0b('0x67'));let _0x24f492={};if(!_0x347878||_0x347878['length']<0x1)throw new Error('No\x20applets\x20installed\x20with\x20ID:\x20'+_0x5e342c);for(e of _0x347878)_0x24f492[e['id']]=e['isRunning'](),e['isRunning']()&&(logger[_0xfc0b('0x10')](_0xfc0b('0x68')+e['id']),await stop(e),logger[_0xfc0b('0x10')](_0xfc0b('0x69'))),e['status']=ExtensionState['UPDATING'];let _0x3b9da1=Path[_0xfc0b('0xd')](extensionBaseDir,_0x5e342c+'');if(logger[_0xfc0b('0x10')]('Checking\x20for\x20existing\x20applet\x20at\x20'+_0x3b9da1),!fs[_0xfc0b('0x11')](_0x3b9da1))throw new Error('No\x20extension\x20installed\x20at\x20expected\x20location!');logger[_0xfc0b('0x10')]('Deleting\x20previously\x20installed\x20extension\x20at:\x20'+_0x3b9da1);try{del[_0xfc0b('0x1c')](_0x3b9da1);try{await downloadAndInstall(_0x43fbf3,_0x3b9da1)[_0xfc0b('0x53')](async function(){let _0x5e342c=Path[_0xfc0b('0xd')](_0x3b9da1,_0xfc0b('0x44')),_0x3dafd6=null;try{_0x3dafd6=loadJsonFile(_0x5e342c);}catch(_0x1963eb){throw new Error(_0xfc0b('0x6a')+_0x5e342c,_0x1963eb);}for(e of _0x347878)e[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x6b')],e[_0xfc0b('0x1d')]=_0x43fbf3;for(e of(updateExtensionStore(),logger[_0xfc0b('0x10')](_0xfc0b('0x6c')),_0x347878))logger[_0xfc0b('0x10')](_0xfc0b('0x6d')+extension['id']),e[_0xfc0b('0x25')](_0x3dafd6),_0x24f492[e['id']]&&(await start(e));logger[_0xfc0b('0x10')](_0xfc0b('0x6e'));});}catch(_0x111288){throw logger[_0xfc0b('0x16')](_0xfc0b('0x41')+_0x3b9da1,_0x111288),extension[_0xfc0b('0x23')]=ExtensionState['ERROR'],_0x111288;}}catch(_0x1db606){throw logger[_0xfc0b('0x16')](_0xfc0b('0x6f'),_0x1db606),_0x1db606;}return findByAppletId(_0x5e342c);}async function initialize(_0x1202d7,_0x4d2a08=0x0){if(logger[_0xfc0b('0x10')]('Current\x20status\x20of\x20extension\x20is:\x20'+_0x1202d7['status']),_0x1202d7[_0xfc0b('0x23')]==ExtensionState['INSTALLING'])return logger[_0xfc0b('0x10')]('Waiting\x20for\x20extension\x20'+_0x1202d7['id']+_0xfc0b('0x70')),new Promise((_0xb01064,_0x58b04c)=>{setTimeout(()=>_0xb01064(start(_0x1202d7,_0x4d2a08+0x1)['catch'](_0x29ec26=>{_0x58b04c(_0x29ec26);})),0x3e8);});if(_0x1202d7[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x71')])return logger[_0xfc0b('0x10')](_0xfc0b('0x72')+_0x1202d7['id']+_0xfc0b('0x73')),new Promise((_0x1fc9f3,_0x457a88)=>{setTimeout(()=>_0x1fc9f3(start(_0x1202d7,_0x4d2a08+0x1)['catch'](_0x235ee8=>{_0x457a88(_0x235ee8);})),0x3e8);});if(_0x1202d7[_0xfc0b('0x23')]==ExtensionState['ERROR'])throw logger[_0xfc0b('0x16')](_0xfc0b('0x74')),new Error(_0xfc0b('0x75')+_0x1202d7['id']+_0xfc0b('0x76'));if(_0x1202d7[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x77')])logger[_0xfc0b('0x10')](_0xfc0b('0x78'));else if(_0x1202d7[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x79')])logger[_0xfc0b('0x10')]('Extension\x20is\x20already\x20initializing.');else{if(logger[_0xfc0b('0x10')](_0xfc0b('0x7a')+_0x1202d7['id']),logger[_0xfc0b('0x10')](_0xfc0b('0x7b')+instances['length']+_0xfc0b('0x7c')),_0x1202d7[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x79')],updateExtensionStore(),!_0x1202d7[_0xfc0b('0x1f')])throw new Error(_0xfc0b('0x7d'));if(!_0x1202d7[_0xfc0b('0x21')])throw new Error(_0xfc0b('0x7e'),_0x1202d7);let _0x4d2a08=Path[_0xfc0b('0xd')](extensionBaseDir,_0x1202d7[_0xfc0b('0x1e')]+''),_0x1b4352=Path[_0xfc0b('0xd')](_0x4d2a08+'/'+_0x1202d7['entryPoint']),_0x95b819=await generateRuntimeConfiguration(_0x1202d7);if(logger[_0xfc0b('0x10')](_0xfc0b('0x7f'),_0x1b4352),logger[_0xfc0b('0x10')](_0xfc0b('0x80'),JSON['stringify'](_0x95b819)),fs[_0xfc0b('0x11')](_0x4d2a08)){const _0x3f6636={'loggingOptions':JSON[_0xfc0b('0x81')](logger['options'])};Object[_0xfc0b('0x82')](_0x3f6636,process[_0xfc0b('0xb')]);let _0x3908a7=fork(_0x1b4352,[JSON[_0xfc0b('0x81')](_0x95b819)],{'cwd':_0x4d2a08,'env':_0x3f6636});logger[_0xfc0b('0x10')](_0xfc0b('0x83'));let _0x4ed6a5=new ExtensionInstance(_0x1202d7,_0x3908a7);return registerChildEvents(_0x4ed6a5),instances[_0xfc0b('0x45')](_0x4ed6a5),logger[_0xfc0b('0x10')]('Child\x20object\x20created.'),_0x1202d7[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x5e')],updateExtensionStore(),logger[_0xfc0b('0x10')]('Initialization\x20complete.'),_0x1202d7;}logger[_0xfc0b('0x16')](_0xfc0b('0x84')+_0x4d2a08),_0x1202d7[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x42')],updateExtensionStore();}}async function generateRuntimeConfiguration(_0x4e6df2){let _0x1e1d60=_0x4e6df2[_0xfc0b('0x32')]||{};if(!_0x1e1d60[_0xfc0b('0x85')])throw new Error(_0xfc0b('0x86'));return _0x1e1d60[_0xfc0b('0x87')]=_0x4e6df2['id'],_0x1e1d60[_0xfc0b('0x88')]=Path[_0xfc0b('0xd')](extensionStorageDir,_0x4e6df2['id']),_0x1e1d60;}const maxStartAttempts=0xa;async function start(_0x15ddfe,_0x5e2650=0x0){if(_0x5e2650>maxStartAttempts)throw new Error(_0xfc0b('0x89')+_0x15ddfe['id']);if(_0x15ddfe[_0xfc0b('0x23')]===ExtensionState[_0xfc0b('0x24')]||_0x15ddfe[_0xfc0b('0x23')]===ExtensionState[_0xfc0b('0x6b')]||_0x15ddfe[_0xfc0b('0x23')]===ExtensionState['STOPPED'])return logger[_0xfc0b('0x10')](_0xfc0b('0x8a')+_0x15ddfe['id']+'\x20to\x20initialize.'),initialize(_0x15ddfe),new Promise((_0x200b9a,_0x5b768f)=>{setTimeout(()=>_0x200b9a(start(_0x15ddfe,_0x5e2650+0x1)[_0xfc0b('0x46')](_0x4db6c6=>{_0x5b768f(_0x4db6c6);})),0x3e8);});if(_0x15ddfe['status']==ExtensionState[_0xfc0b('0x8b')]||_0x15ddfe[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x5d')])return logger[_0xfc0b('0x10')](_0xfc0b('0x75')+_0x15ddfe['id']+_0xfc0b('0x8c')),getChild(_0x15ddfe['id']);if(_0x15ddfe[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x42')])throw logger[_0xfc0b('0x10')](_0xfc0b('0x75')+_0x15ddfe['id']+_0xfc0b('0x76')),new Error(_0xfc0b('0x75')+_0x15ddfe['id']+_0xfc0b('0x76'));if(_0x15ddfe[_0xfc0b('0x23')]==ExtensionState['INITIALIZING'])return logger['info']('Waiting\x20for\x20extension\x20'+_0x15ddfe['id']+'\x20to\x20initialize.'),new Promise((_0x565c07,_0x39d97b)=>{setTimeout(()=>_0x565c07(start(_0x15ddfe,_0x5e2650+0x1)[_0xfc0b('0x46')](_0x2dfcd2=>{_0x39d97b(_0x2dfcd2);})),0x3e8);});if(_0x15ddfe['status']==ExtensionState[_0xfc0b('0x71')])return logger[_0xfc0b('0x10')](_0xfc0b('0x72')+_0x15ddfe['id']+_0xfc0b('0x73')),new Promise((_0x5c2bf6,_0x2e1dd7)=>{setTimeout(()=>_0x5c2bf6(start(_0x15ddfe,_0x5e2650+0x1)['catch'](_0x1612af=>{_0x2e1dd7(_0x1612af);})),0x3e8);});{logger[_0xfc0b('0x10')]('Starting\x20extension:\x20'+_0x15ddfe['id']),logger[_0xfc0b('0x10')](_0xfc0b('0x8d')+_0x15ddfe[_0xfc0b('0x23')]),logger[_0xfc0b('0x10')](_0xfc0b('0x7b')+instances[_0xfc0b('0x3d')]+'\x20children\x20currently\x20running');const _0x2a4c2d=getChild(_0x15ddfe['id']);return _0x2a4c2d?(_0x15ddfe[_0xfc0b('0x23')]=ExtensionState['STARTING'],updateExtensionStore(),_0x2a4c2d[_0xfc0b('0x39')][_0xfc0b('0x63')](JSON[_0xfc0b('0x81')]({'data':{'type':_0xfc0b('0x8e')}})),_0x15ddfe[_0xfc0b('0x22')]=!0x0,_0x15ddfe[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x5d')],updateExtensionStore(),logger[_0xfc0b('0x10')](_0xfc0b('0x8f')),_0x2a4c2d):(logger['info']('Waiting\x20for\x20child\x20process\x20for\x20'+_0x15ddfe['id']),logger[_0xfc0b('0x10')](_0x15ddfe[_0xfc0b('0x90')]),new Promise((_0x130f61,_0x11d7ac)=>{setTimeout(()=>_0x130f61(start(_0x15ddfe,_0x5e2650+0x1)[_0xfc0b('0x46')](_0xf54717=>{_0x11d7ac(_0xf54717);})),0x3e8);}));}}async function pause(_0x31efe4){if(!_0x31efe4[_0xfc0b('0x34')]())throw new Error('Extension\x20is\x20not\x20running:\x20'+_0x31efe4['id']);const _0x4b7e01=getChild(_0x31efe4['id']);if(null!==_0x4b7e01){logger[_0xfc0b('0x10')](_0xfc0b('0x91')+_0x31efe4['id']),_0x31efe4['status']=ExtensionState[_0xfc0b('0x92')],updateExtensionStore();try{_0x4b7e01[_0xfc0b('0x39')][_0xfc0b('0x63')](JSON[_0xfc0b('0x81')]({'data':{'type':_0xfc0b('0x93')}})),_0x31efe4[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x5f')],updateExtensionStore();}catch(_0x5f4b5b){logger[_0xfc0b('0x16')](_0xfc0b('0x94')+_0x31efe4['id']),_0x31efe4[_0xfc0b('0x23')]=ExtensionState['UNKNOWN'],updateExtensionStore();}return _0x4b7e01;}return logger['info'](_0xfc0b('0x95')+_0x31efe4['id']),null;}async function stop(_0x117eb0){if(!_0x117eb0[_0xfc0b('0x34')]())return logger[_0xfc0b('0x96')](_0xfc0b('0x97')+_0x117eb0['id']),null;const _0x468cfa=getChild(_0x117eb0['id']);if(null!==_0x468cfa){logger[_0xfc0b('0x10')](_0xfc0b('0x98')+_0x117eb0['id']),_0x117eb0['status']=ExtensionState[_0xfc0b('0x71')],updateExtensionStore();try{_0x468cfa[_0xfc0b('0x39')][_0xfc0b('0x99')](_0xfc0b('0x9a'));}catch(_0x46a495){logger[_0xfc0b('0x16')](_0xfc0b('0x9b')+_0x117eb0['id']),_0x117eb0[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0x9c')],updateExtensionStore();}return confirmStop(_0x117eb0,_0x468cfa);}return logger[_0xfc0b('0x10')]('No\x20child\x20process\x20for\x20extensions:\x20'+_0x117eb0['id']),null;}const maxStopAttempts=0xa;async function confirmStop(_0x336b03,_0x1123a8,_0x5ace0b=0x0){if(_0x5ace0b>maxStopAttempts)throw new Error(_0xfc0b('0x9d')+maxStopAttempts+'\x20attempts.');return logger[_0xfc0b('0x10')]('Confirming\x20stop...'),_0x336b03[_0xfc0b('0x23')]==ExtensionState[_0xfc0b('0x71')]?new Promise((_0x45c6e0,_0x182f2f)=>{setTimeout(()=>_0x45c6e0(confirmStop(_0x336b03,_0x1123a8,_0x5ace0b+0x1)[_0xfc0b('0x46')](_0x44b111=>{_0x182f2f(_0x44b111);})),0x3e8);}):(logger[_0xfc0b('0x10')]('confirmStop\x20has\x20status\x20'+_0x336b03[_0xfc0b('0x23')]),updateExtensionStore(),_0x1123a8);}function removeChildInstance(_0x23e81e){logger[_0xfc0b('0x10')](_0xfc0b('0x9e')+_0x23e81e[_0xfc0b('0x38')]['id']);let _0x43a8e5=instances[_0xfc0b('0x9f')](_0x23e81e);_0x43a8e5>-0x1?(logger['info'](_0xfc0b('0xa0')+_0x43a8e5),instances[_0xfc0b('0xa1')](_0x43a8e5,0x1)):logger[_0xfc0b('0x10')](_0xfc0b('0xa2'));}async function disable(_0x1e8fc8){_0x1e8fc8[_0xfc0b('0x34')]()&&(await stop(_0x1e8fc8)),_0x1e8fc8['enabled']=!0x1,updateExtensionStore();}async function restart(_0x520bfd){return logger[_0xfc0b('0x10')](_0xfc0b('0xa3')+_0x520bfd['id']),await stop(_0x520bfd),start(_0x520bfd);}async function remove(_0xb41261){logger[_0xfc0b('0x10')]('Deleting\x20extension:\x20'+_0xb41261['id']),_0xb41261[_0xfc0b('0x34')]()&&(await stop(_0xb41261)),_0xb41261[_0xfc0b('0x23')]=ExtensionState[_0xfc0b('0xa4')],updateExtensionStore();let _0x550981=extensions[_0xfc0b('0x9f')](_0xb41261);extensions[_0xfc0b('0xa1')](_0x550981,0x1),updateExtensionStore(),logger['info'](_0xfc0b('0xa5'));let _0x5a1ce7=findByAppletId(_0xb41261[_0xfc0b('0x1e')]);if(!_0x5a1ce7||0x0===_0x5a1ce7[_0xfc0b('0x3d')]){let _0xb37523=Path[_0xfc0b('0xd')](extensionBaseDir,_0xb41261[_0xfc0b('0x1e')]+'');fs['existsSync'](_0xb37523)&&(logger[_0xfc0b('0x10')](_0xfc0b('0xa6')+_0xb37523),del[_0xfc0b('0x1c')](_0xb37523));}return!0x0;}const callbackMap={};function registerMessageResponse(_0x17f859,_0x393397){logger[_0xfc0b('0x10')]('Registering\x20message\x20response\x20for:\x20'+_0x17f859),callbackMap[_0x17f859]=_0x393397;}function registerChildEvents(_0xc27086){if(!_0xc27086)throw new Error(_0xfc0b('0xa7'));registerStopEvent(_0xc27086,'exit'),registerStopEvent(_0xc27086,_0xfc0b('0xa8')),registerStopEvent(_0xc27086,_0xfc0b('0x16')),registerStopEvent(_0xc27086,_0xfc0b('0xa9')),_0xc27086[_0xfc0b('0x39')]['on']('message',_0x4ea758=>{logger[_0xfc0b('0x10')](_0xfc0b('0xaa')+_0x4ea758);const _0x991f3d=JSON['parse'](_0x4ea758);if(_0x991f3d)if(callbackMap[_0xc27086['extension']['id']]){logger[_0xfc0b('0x10')]('Calling\x20back\x20via\x20function');let _0x4ea758=callbackMap[_0xc27086[_0xfc0b('0x38')]['id']];try{_0x4ea758(_0x991f3d);}catch(_0x2a9253){logger[_0xfc0b('0x16')]('Callback\x20function\x20got\x20error:',_0x2a9253);}}else{const _0xc27086=(json[_0xfc0b('0xab')]||{})[_0xfc0b('0xac')];logger[_0xfc0b('0x16')](_0xfc0b('0xad')+_0xc27086);}else logger['error']('PARENT:\x20Expected\x20JSON\x20message\x20format,\x20but\x20got:\x20'+_0x4ea758);});}function registerStopEvent(_0x4aa4d6,_0x4c3f2e){_0x4aa4d6[_0xfc0b('0x39')]['on'](_0x4c3f2e,function(_0x38ad1d,_0x5666a2){logger[_0xfc0b('0x10')]('Child\x20'+_0x4aa4d6[_0xfc0b('0x38')]['id']+_0xfc0b('0xae')+_0x4c3f2e+_0xfc0b('0xaf')+_0x38ad1d+_0xfc0b('0xb0')+_0x5666a2+'\x27'),_0x4aa4d6[_0xfc0b('0x23')]=_0x4c3f2e,_0x4aa4d6[_0xfc0b('0xb1')]=_0x38ad1d,_0x4aa4d6[_0xfc0b('0xb2')]=_0x5666a2,_0x4aa4d6[_0xfc0b('0x38')]['status']=ExtensionState[_0xfc0b('0x35')],removeChildInstance(_0x4aa4d6),updateExtensionStore();});}async function getExtensions(){if(null===extensions)for(json of(extensions=[],extensionsJson=(await store[_0xfc0b('0xb3')](_0xfc0b('0xf')))||[],extensionsJson))extensions[_0xfc0b('0x45')](Extension[_0xfc0b('0x36')](json));return extensions;}async function updateExtensionStore(){if(null===store)throw new Error('Store\x20object\x20is\x20null.');try{return store[_0xfc0b('0x14')](_0xfc0b('0xf'),extensions);}catch(_0x157361){throw console['error'](_0xfc0b('0xb4')),_0x157361;}}function getChild(_0x5c7c34){for(let _0x4aee2b=0x0;_0x4aee2b<instances[_0xfc0b('0x3d')];_0x4aee2b++)if(instances[_0x4aee2b][_0xfc0b('0x38')]['id']===_0x5c7c34)return instances[_0x4aee2b];return logger['error'](_0xfc0b('0xb5')+_0x5c7c34),null;}async function getExtension(_0x245ef1){return getExtensions()[_0xfc0b('0x53')](function(_0x13d463){let _0x471c31=null;for(let _0xfde5d6 of _0x13d463)_0xfde5d6['id']===_0x245ef1&&(logger['info'](_0xfc0b('0xb6')+_0xfde5d6['id']),_0x471c31=_0xfde5d6);if(null===_0x471c31)throw logger['info'](_0xfc0b('0xb7')+_0x245ef1),new Error('No\x20match\x20found\x20for\x20id:\x20'+_0x245ef1);return _0x471c31;});}function getOauth2Client(_0x487b84){let _0x48385d=_0x487b84[_0xfc0b('0x1f')][_0xfc0b('0x28')][_0xfc0b('0xb8')][_0xfc0b('0x2e')]['data'];return new ClientOAuth2({'clientId':_0x48385d['clientId'],'clientSecret':_0x48385d[_0xfc0b('0xb9')],'accessTokenUri':_0x48385d[_0xfc0b('0xba')],'authorizationUri':_0x48385d[_0xfc0b('0xbb')],'redirectUri':_0xfc0b('0xbc'),'scopes':_0x48385d[_0xfc0b('0xbd')],'state':uuidv4()});}async function getOptions(_0x50fed3,_0x2d8e4a,_0x23b7b3,_0x56f723){const _0x5a38dd=getChild(_0x50fed3['id']);let _0x59d78f={'data':{'type':_0xfc0b('0xbe'),'fieldName':_0x2d8e4a,'search':_0x23b7b3}};if(!_0x5a38dd||!_0x5a38dd[_0xfc0b('0x39')])throw new Error(_0xfc0b('0xbf')+_0x50fed3['id']);registerMessageResponse(_0x50fed3['id'],_0x23382b=>{const _0x2d8e4a=(_0x23382b[_0xfc0b('0xab')]||{})[_0xfc0b('0xac')];switch(_0x2d8e4a){case'OPTIONS':logger[_0xfc0b('0x10')]('PARENT:\x20Handling\x20'+_0x2d8e4a),_0x56f723['send'](_0x23382b[_0xfc0b('0xab')][_0xfc0b('0xc0')]),logger['info'](_0xfc0b('0xc1'));break;default:logger[_0xfc0b('0x16')](_0xfc0b('0xad')+_0x2d8e4a);}}),_0x5a38dd['process']['send'](JSON['stringify'](_0x59d78f));}function findByAppletId(_0x347f4c){let _0x201168=[];for(extension of extensions)_0x347f4c==extension[_0xfc0b('0x1e')]&&_0x201168[_0xfc0b('0x45')](extension);return _0x201168;}async function factoryReset(){if(logger['info']('Deleting\x20extensions...'),null!=extensions){for(extension of[...extensions])logger[_0xfc0b('0x10')](_0xfc0b('0xc2')+extension['id']),await remove(extension),logger['info'](_0xfc0b('0xc3')+extension['id']);updateExtensionStore();}return fs[_0xfc0b('0xc4')](extensionStorageDir,(_0x318f33,_0x4e34b7)=>{if(_0x318f33)throw logger[_0xfc0b('0x16')]('Error\x20removing\x20extension\x20storage:\x20'+_0x318f33),_0x318f33;for(const _0x318f33 of _0x4e34b7)logger[_0xfc0b('0x10')]('Unlinking\x20extension\x20storage:\x20'+_0x318f33),del[_0xfc0b('0x1c')](Path[_0xfc0b('0xc5')](extensionStorageDir,_0x318f33),_0x59c5f4=>{if(_0x59c5f4)throw logger['error'](_0xfc0b('0xc6')+_0x318f33,_0x59c5f4),_0x59c5f4;});}),!0x0;}const ExtensionState=Object[_0xfc0b('0xc7')]({'INITIAL':_0xfc0b('0x24'),'INITIALIZING':_0xfc0b('0x79'),'INITIALIZED':_0xfc0b('0x5e'),'INSTALLING':_0xfc0b('0xc8'),'INSTALLED':_0xfc0b('0x6b'),'PAUSING':_0xfc0b('0x92'),'PAUSED':'PAUSED','STARTING':_0xfc0b('0x8b'),'STARTED':_0xfc0b('0x5d'),'STOPPING':_0xfc0b('0x71'),'STOPPED':_0xfc0b('0x35'),'UNINSTALLING':_0xfc0b('0x77'),'UPDATING':'UPDATING','UNKNOWN':'UNKNOWN','ERROR':_0xfc0b('0x42')});module[_0xfc0b('0xc9')]={'Extension':Extension,'ExtensionInstance':ExtensionInstance,'ExtensionState':ExtensionState,'configure':configure,'factoryReset':factoryReset,'findByAppletId':findByAppletId,'getChild':getChild,'getExtension':getExtension,'getExtensions':getExtensions,'getOauth2Client':getOauth2Client,'getOptions':getOptions,'init':init,'initialize':initialize,'install':install,'pause':pause,'reconfigure':configure,'registerMessageResponse':registerMessageResponse,'remove':remove,'restart':restart,'start':start,'disable':disable,'stop':stop,'storageRoot':storageRoot,'upgrade':upgrade};